# A2: 2行バッチ送信のCSVタイミング検証（2025-08-28）

## 概要

- 目的: 送信側で「2行/通知」バッチ実装（A2）の効果を、受信CSVのタイムスタンプ間隔から評価。
- 期待: 1通知あたりの情報量を2倍にして、実効サンプルレートの底上げを狙う（インターフェース変更なし、改行区切りのまま）。

## 記録ファイル

- パス: `receiver/recordings/2025-08-28/sensor_data_20250828_234511.csv`
- 行数: 703（intervals=702）
- 記録時間: 約24.0秒（duration_ms=24015）

## 解析コマンド

- 実行: `receiver/scripts/analyze_csv_timing.ps1 -Path <CSVパス>`
- 出力（抜粋）:
  - `delta_ms: avg=34.209 min=14 p50=18 p90=61 p95=94 p99=116 max=160`
  - `rate_hz: by_avg=29.232 by_span=29.232`
  - `jitter: over_36ms=222 (31.62% of intervals)`

## 所見

- 実効レートは約29.2 Hz。A1ベースライン（約20.1 Hz）から約+45%の改善。
- p50=18msと短い間隔が多く、p90=61ms・p95=94msと長い間隔が混在。
  - 典型的なパターン: 「短い間隔（バッチ内の2行）」と「やや長い間隔（通知間）」の交互。A2の狙い通り、1回の通知で2行が流れていると解釈できる。
- 最大160ms、p99=116msのスパイクはBLE接続イベントのばらつき（中央側スケジューリングやOS負荷）と整合。

## 考察 / 次アクション

- さらなる底上げ案（インターフェース不変）:
  - 2.5案: 「3行/通知」バッチ化（送信側FIFO既存）。受信側は改行区切りで既対応。
  - A1微調整: BLE送信間隔（例: 40→30ms）試験。ただし中央側のスケジューリング制約により効果は環境依存。
  - MTU/PHY最適化: 端末環境次第だが、MTU拡大・2M PHY（対応機種のみ）はイベントあたりの実効容量向上に寄与しうる。
- 記録の再現性確保のため、異なる場所/PC負荷条件での再計測も推奨。

---

- 結論: A2（2行/通知）は、ベースライン比で約+45%のスループット改善を確認。目標40Hz級を狙うなら、3行/通知または送信間隔微調整のABテストを次段として提案。
